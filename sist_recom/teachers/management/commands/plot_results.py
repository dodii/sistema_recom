import math
import matplotlib.pyplot as plt
import numpy as np
from collections import Counter
from django.core.management.base import BaseCommand


class Command(BaseCommand):

    def handle(self, *args, **options):

        all_results = {}

        all_results["Implementación con entrada solo título"] = [
            ("Hernán Sarmiento A.", 34),
            ("Ismael Figueroa P.", 32),
            ("Alejandro Hevia A.", 31),
            ("Iván Sipiran", 31),
            ("José M. Saavedra R.", 29),
            ("Nancy Hitschfeld K.", 28),
            ("Felipe Bravo Marquez", 28),
            ("Ivana Bachmann", 26),
            ("Aidan Hogan", 26),
            ("María Cecilia Rivara Z.", 22),
            ("Gonzalo Navarro", 22),
            ("Jazmine Maldonado", 22),
            ("Bárbara Poblete", 21),
            ("Javier Bustos Jiménez", 20),
            ("Jens Hardings P.", 20),
            ("Benjamín Bustos", 19),
            ("Éric Tanter", 19),
            ("Daniel Perovich", 19),
            ("Valentin Barriere", 19),
            ("Cecilia Bastarrica", 18),
            ("Matías Toro I.", 18),
            ("Sergio F. Ochoa D.", 17),
            ("Eduardo Graells Garrido", 15),
            ("Jose Pino U.", 13),
            ("Nelson Baloian T.", 13),
            ("Ricardo Baeza Y.", 13),
            ("Luciano Radrigan F.", 13),
            ("Andrés Abeliuk", 12),
            ("Jaime Sanchez I.", 11),
            ("Edgar Pineda L.", 11),
            ("Claudio Gutiérrez", 10),
            ("Jocelyn Simmonds", 9),
            ("Valentin Muñoz A.", 9),
            ("Juan Manuel Barrios", 8),
            ("Alexandre Bergel", 8),
            ("Patricio Poblete", 7),
            ("Mauricio Cerda V.", 6),
            ("Federico Olmedo", 5),
            ("José M. Piquer", 4),
            ("Elías Zelada B.", 4),
            ("Luis Mateu B.", 3),
            ("Patricio Inostroza F.", 3),
            ("Francisco J. Gutiérrez", 1),
            ("Matías Torrealba", 1),
            ("Tomás Barros", 0),
            ("Mauricio Palma L.", 0),
        ]

        all_results["Implementación entrada título y texto"] = [
            ("Hernán Sarmiento A.", 41),
            ("Javier Bustos Jiménez", 32),
            ("Jens Hardings P.", 32),
            ("Ivana Bachmann", 31),
            ("Alejandro Hevia A.", 30),
            ("Jazmine Maldonado", 29),
            ("Aidan Hogan", 27),
            ("Iván Sipiran", 26),
            ("Ismael Figueroa P.", 26),
            ("Bárbara Poblete", 24),
            ("Daniel Perovich", 24),
            ("Felipe Bravo Marquez", 22),
            ("Eduardo Graells Garrido", 21),
            ("José M. Saavedra R.", 20),
            ("Cecilia Bastarrica", 19),
            ("Gonzalo Navarro", 19),
            ("Andrés Abeliuk", 19),
            ("Sergio F. Ochoa D.", 18),
            ("Valentin Barriere", 18),
            ("Nancy Hitschfeld K.", 17),
            ("Jose Pino U.", 15),
            ("Jaime Sanchez I.", 15),
            ("Matías Toro I.", 15),
            ("María Cecilia Rivara Z.", 14),
            ("Nelson Baloian T.", 13),
            ("Edgar Pineda L.", 13),
            ("Ricardo Baeza Y.", 12),
            ("Éric Tanter", 12),
            ("Mauricio Cerda V.", 11),
            ("Jocelyn Simmonds", 10),
            ("Valentin Muñoz A.", 9),
            ("Patricio Poblete", 9),
            ("Claudio Gutiérrez", 8),
            ("Benjamín Bustos", 8),
            ("Federico Olmedo", 8),
            ("Luciano Radrigan F.", 8),
            ("Alexandre Bergel", 7),
            ("Juan Manuel Barrios", 6),
            ("Elías Zelada B.", 4),
            ("José M. Piquer", 2),
            ("Patricio Inostroza F.", 2),
            ("Matías Torrealba", 2),
            ("Luis Mateu B.", 1),
            ("Francisco J. Gutiérrez", 1),
            ("Tomás Barros", 0),
            ("Mauricio Palma L.", 0),
        ]

        all_results["Sin score para keywords entrada, solo título"] = [
            ("Luciano Radrigan F.", 85),
            ("Gonzalo Navarro", 71),
            ("María Cecilia Rivara Z.", 60),
            ("Cecilia Bastarrica", 54),
            ("Nancy Hitschfeld K.", 53),
            ("José M. Saavedra R.", 41),
            ("Javier Bustos Jiménez", 38),
            ("Iván Sipiran", 37),
            ("Hernán Sarmiento A.", 33),
            ("Jens Hardings P.", 33),
            ("Daniel Perovich", 32),
            ("Felipe Bravo Marquez", 30),
            ("Ivana Bachmann", 20),
            ("Federico Olmedo", 17),
            ("Aidan Hogan", 14),
            ("Eduardo Graells Garrido", 13),
            ("Alejandro Hevia A.", 12),
            ("Ismael Figueroa P.", 8),
            ("Alexandre Bergel", 8),
            ("Valentin Barriere", 5),
            ("Valentin Muñoz A.", 5),
            ("Patricio Poblete", 5),
            ("Andrés Abeliuk", 4),
            ("Jaime Sanchez I.", 3),
            ("Patricio Inostroza F.", 3),
            ("Benjamín Bustos", 3),
            ("Edgar Pineda L.", 3),
            ("Mauricio Cerda V.", 3),
            ("Jazmine Maldonado", 2),
            ("Jose Pino U.", 1),
            ("Bárbara Poblete", 1),
            ("Sergio F. Ochoa D.", 1),
            ("Francisco J. Gutiérrez", 1),
            ("Matías Torrealba", 1),
            ("Nelson Baloian T.", 0),
            ("José M. Piquer", 0),
            ("Ricardo Baeza Y.", 0),
            ("Claudio Gutiérrez", 0),
            ("Luis Mateu B.", 0),
            ("Tomás Barros", 0),
            ("Jocelyn Simmonds", 0),
            ("Juan Manuel Barrios", 0),
            ("Éric Tanter", 0),
            ("Matías Toro I.", 0),
            ("Elías Zelada B.", 0),
            ("Mauricio Palma L.", 0),
        ]

        all_results["Sin score para keywords entrada, con título y texto"] = [
            ("Luciano Radrigan F.", 69),
            ("María Cecilia Rivara Z.", 68),
            ("Gonzalo Navarro", 55),
            ("Jens Hardings P.", 53),
            ("Felipe Bravo Marquez", 52),
            ("Iván Sipiran", 45),
            ("Hernán Sarmiento A.", 45),
            ("Nancy Hitschfeld K.", 42),
            ("José M. Saavedra R.", 39),
            ("Cecilia Bastarrica", 38),
            ("Javier Bustos Jiménez", 34),
            ("Eduardo Graells Garrido", 32),
            ("Daniel Perovich", 30),
            ("Ivana Bachmann", 16),
            ("Federico Olmedo", 13),
            ("Aidan Hogan", 12),
            ("Andrés Abeliuk", 7),
            ("Patricio Poblete", 7),
            ("Bárbara Poblete", 6),
            ("Alejandro Hevia A.", 5),
            ("Valentin Barriere", 5),
            ("Valentin Muñoz A.", 5),
            ("Mauricio Cerda V.", 4),
            ("Jose Pino U.", 3),
            ("Alexandre Bergel", 3),
            ("Jaime Sanchez I.", 2),
            ("Benjamín Bustos", 2),
            ("Ismael Figueroa P.", 2),
            ("Nelson Baloian T.", 1),
            ("Patricio Inostroza F.", 1),
            ("Sergio F. Ochoa D.", 1),
            ("Francisco J. Gutiérrez", 1),
            ("Matías Torrealba", 1),
            ("Jazmine Maldonado", 1),
            ("José M. Piquer", 0),
            ("Ricardo Baeza Y.", 0),
            ("Claudio Gutiérrez", 0),
            ("Luis Mateu B.", 0),
            ("Tomás Barros", 0),
            ("Jocelyn Simmonds", 0),
            ("Juan Manuel Barrios", 0),
            ("Éric Tanter", 0),
            ("Matías Toro I.", 0),
            ("Elías Zelada B.", 0),
            ("Edgar Pineda L.", 0),
            ("Mauricio Palma L.", 0),
        ]

        all_results["Sin ningún score, solo título"] = [
            ("Gonzalo Navarro", 64),
            ("Javier Bustos Jiménez", 58),
            ("Cecilia Bastarrica", 58),
            ("Nancy Hitschfeld K.", 52),
            ("Sergio F. Ochoa D.", 48),
            ("Daniel Perovich", 44),
            ("María Cecilia Rivara Z.", 41),
            ("Patricio Inostroza F.", 38),
            ("Patricio Poblete", 32),
            ("Benjamín Bustos", 26),
            ("José M. Saavedra R.", 21),
            ("Jens Hardings P.", 20),
            ("Jose Pino U.", 16),
            ("Bárbara Poblete", 15),
            ("Jazmine Maldonado", 14),
            ("Jaime Sanchez I.", 13),
            ("Aidan Hogan", 13),
            ("Jocelyn Simmonds", 11),
            ("Iván Sipiran", 11),
            ("Alexandre Bergel", 11),
            ("José M. Piquer", 10),
            ("Claudio Gutiérrez", 10),
            ("Felipe Bravo Marquez", 10),
            ("Eduardo Graells Garrido", 9),
            ("Nelson Baloian T.", 8),
            ("Alejandro Hevia A.", 8),
            ("Federico Olmedo", 8),
            ("Luciano Radrigan F.", 8),
            ("Valentin Barriere", 6),
            ("Mauricio Cerda V.", 6),
            ("Francisco J. Gutiérrez", 4),
            ("Andrés Abeliuk", 3),
            ("Ivana Bachmann", 3),
            ("Matías Torrealba", 1),
            ("Ricardo Baeza Y.", 0),
            ("Luis Mateu B.", 0),
            ("Tomás Barros", 0),
            ("Juan Manuel Barrios", 0),
            ("Éric Tanter", 0),
            ("Matías Toro I.", 0),
            ("Elías Zelada B.", 0),
            ("Hernán Sarmiento A.", 0),
            ("Edgar Pineda L.", 0),
            ("Mauricio Palma L.", 0),
            ("Valentin Muñoz A.", 0),
            ("Ismael Figueroa P.", 0),
        ]

        all_results["Sin ningún score, título y texto"] = [
            ("Gonzalo Navarro", 53),
            ("Cecilia Bastarrica", 52),
            ("Daniel Perovich", 52),
            ("Javier Bustos Jiménez", 50),
            ("Sergio F. Ochoa D.", 46),
            ("María Cecilia Rivara Z.", 45),
            ("Patricio Poblete", 41),
            ("Patricio Inostroza F.", 36),
            ("Jens Hardings P.", 35),
            ("Nancy Hitschfeld K.", 33),
            ("Benjamín Bustos", 31),
            ("Felipe Bravo Marquez", 25),
            ("Bárbara Poblete", 23),
            ("Eduardo Graells Garrido", 18),
            ("Jose Pino U.", 17),
            ("Nelson Baloian T.", 17),
            ("José M. Saavedra R.", 17),
            ("Claudio Gutiérrez", 14),
            ("Jaime Sanchez I.", 13),
            ("Aidan Hogan", 12),
            ("Valentin Barriere", 12),
            ("Alejandro Hevia A.", 10),
            ("Iván Sipiran", 7),
            ("Jazmine Maldonado", 7),
            ("Mauricio Cerda V.", 7),
            ("Alexandre Bergel", 6),
            ("Jocelyn Simmonds", 5),
            ("Federico Olmedo", 4),
            ("Luciano Radrigan F.", 4),
            ("Francisco J. Gutiérrez", 3),
            ("Andrés Abeliuk", 2),
            ("José M. Piquer", 1),
            ("Ivana Bachmann", 1),
            ("Matías Torrealba", 1),
            ("Ricardo Baeza Y.", 0),
            ("Luis Mateu B.", 0),
            ("Tomás Barros", 0),
            ("Juan Manuel Barrios", 0),
            ("Éric Tanter", 0),
            ("Matías Toro I.", 0),
            ("Elías Zelada B.", 0),
            ("Hernán Sarmiento A.", 0),
            ("Edgar Pineda L.", 0),
            ("Mauricio Palma L.", 0),
            ("Valentin Muñoz A.", 0),
            ("Ismael Figueroa P.", 0),
        ]

        # for result_name, result_list in all_results.items():
        #     counts = [data[1] for data in result_list]
        #     print(counts)

        #     avg = np.mean(counts)
        #     std = np.std(counts)

        #     # variance = sum(map(lambda x: (x[1] - avg) ** 2, result_list)) / len(
        #     #     result_list
        #     # )
        #     # std = math.sqrt(variance)

        #     # Plot histogram
        #     plt.hist(counts, bins=range(max(counts) + 2), rwidth=0.8)
        #     plt.xlabel("Veces recomendado/a")
        #     plt.ylabel("Número de docentes")
        #     plt.title(f"{result_name}")
        #     plt.xticks(range(0, max(counts) + 2, 5))
        #     plt.grid(axis="y", alpha=0.5)
        #     plt.savefig(f"{result_name}.png")
        #     plt.clf()

        #     print(f"resultado: {result_name} \n avg: {avg} std: {std} \n")

        random_results = {}
        random_results["Aleatorio 68 docentes"] = [
            ("Max Isakson E.", 1046),
            ("Jose Pino U.", 1045),
            ("María Cecilia Rivara Z.", 977),
            ("Juan Álvarez R.", 1009),
            ("Sandra De la Fuente G.", 1053),
            ("Nelson Baloian T.", 1001),
            ("Jaime Sanchez I.", 1069),
            ("José M. Piquer", 968),
            ("Ricardo Baeza Y.", 987),
            ("Claudio Gutiérrez", 1005),
            ("Jose Benguria D.", 1022),
            ("Nancy Hitschfeld K.", 1010),
            ("Pablo González J.", 999),
            ("Alejandro Hevia A.", 1068),
            ("Marisa Ernst E.", 1016),
            ("Luis Mateu B.", 1086),
            ("Bárbara Poblete", 1020),
            ("Eduardo Godoy Vega", 1008),
            ("Cesar Guerrero S.", 1003),
            ("Patricio Inostroza F.", 1023),
            ("Tomás Barros", 1054),
            ("Jocelyn Simmonds", 1041),
            ("Dionisio González G.", 1012),
            ("Javier Bustos Jiménez", 998),
            ("Andrés Muñoz Ordenes", 1012),
            ("Benjamín Bustos", 979),
            ("Juan Manuel Barrios", 1080),
            ("Cecilia Bastarrica", 1021),
            ("Gonzalo Navarro", 1019),
            ("Sergio F. Ochoa D.", 1001),
            ("Éric Tanter", 1021),
            ("Eduardo Graells Garrido", 1003),
            ("Felipe Bravo Marquez", 959),
            ("Andrés Abeliuk", 957),
            ("Francisco J. Gutiérrez", 1051),
            ("Ivana Bachmann", 1038),
            ("Matías Toro I.", 1015),
            ("Daniel Perovich", 1017),
            ("José M. Saavedra R.", 1001),
            ("Iván Sipiran", 1065),
            ("Aidan Hogan", 1073),
            ("Federico Olmedo", 1016),
            ("Valentin Barriere", 1025),
            ("Elías Zelada B.", 972),
            ("José Urzúa R.", 1023),
            ("Matías Torrealba", 1040),
            ("Hernán Sarmiento A.", 1018),
            ("Sergio Salinas F.", 1055),
            ("Eduardo Riveros Roca", 985),
            ("Luciano Radrigan F.", 1015),
            ("Edgar Pineda L.", 1033),
            ("Cristián Parra Oyarce", 1024),
            ("Mauricio Palma L.", 959),
            ("Valentin Muñoz A.", 1020),
            ("Hugo Mora R.", 976),
            ("Jazmine Maldonado", 1067),
            ("Jens Hardings P.", 1026),
            ("Camilo Gómez N.", 1053),
            ("Ismael Figueroa P.", 1018),
            ("Mauricio Cerda V.", 1027),
            ("Adolfo Carrasco A.", 994),
            ("Daniel Calderón S.", 1010),
            ("Alexandre Bergel", 996),
            ("Hugo Beltrán A.", 1011),
            ("Marcel Augsburger B.", 1049),
            ("Juan Arriagada", 986),
            ("Rodrigo Arenas A.", 1011),
            ("Patricio Poblete", 1059),
        ]

        random_results["Aleatorio 46 docentes"] = [
            ("Jose Pino U.", 1495),
            ("María Cecilia Rivara Z.", 1508),
            ("Nelson Baloian T.", 1469),
            ("Jaime Sanchez I.", 1496),
            ("José M. Piquer", 1558),
            ("Ricardo Baeza Y.", 1483),
            ("Claudio Gutiérrez", 1465),
            ("Nancy Hitschfeld K.", 1538),
            ("Alejandro Hevia A.", 1487),
            ("Luis Mateu B.", 1533),
            ("Bárbara Poblete", 1498),
            ("Patricio Inostroza F.", 1499),
            ("Tomás Barros", 1453),
            ("Jocelyn Simmonds", 1556),
            ("Javier Bustos Jiménez", 1512),
            ("Benjamín Bustos", 1518),
            ("Juan Manuel Barrios", 1469),
            ("Cecilia Bastarrica", 1441),
            ("Gonzalo Navarro", 1500),
            ("Sergio F. Ochoa D.", 1464),
            ("Éric Tanter", 1506),
            ("Eduardo Graells Garrido", 1493),
            ("Felipe Bravo Marquez", 1544),
            ("Andrés Abeliuk", 1524),
            ("Francisco J. Gutiérrez", 1545),
            ("Ivana Bachmann", 1504),
            ("Matías Toro I.", 1499),
            ("Daniel Perovich", 1544),
            ("José M. Saavedra R.", 1489),
            ("Iván Sipiran", 1458),
            ("Aidan Hogan", 1549),
            ("Federico Olmedo", 1492),
            ("Valentin Barriere", 1539),
            ("Elías Zelada B.", 1533),
            ("Matías Torrealba", 1500),
            ("Hernán Sarmiento A.", 1577),
            ("Luciano Radrigan F.", 1454),
            ("Edgar Pineda L.", 1478),
            ("Mauricio Palma L.", 1522),
            ("Valentin Muñoz A.", 1437),
            ("Jazmine Maldonado", 1540),
            ("Jens Hardings P.", 1511),
            ("Ismael Figueroa P.", 1535),
            ("Mauricio Cerda V.", 1551),
            ("Alexandre Bergel", 1553),
            ("Patricio Poblete", 1481),
        ]

        for result_name, result_list in random_results.items():
            counts = [data[1] for data in result_list]
            counter_obj = Counter(counts)
            print(counts)

            avg = np.mean(counts)
            std = np.std(counts)

            # variance = sum(map(lambda x: (x[1] - avg) ** 2, result_list)) / len(
            #     result_list
            # )
            # std = math.sqrt(variance)

            # Plot histogram
            plt.bar(list(counter_obj.keys()), list(counter_obj.values()))
            plt.xlabel("Veces recomendado/a")
            plt.ylabel("Número de docentes")
            plt.title(f"{result_name}")
            # plt.xticks(np.arange(min(counts), max(counts), step=5))
            plt.yticks(range(int(max(list(counter_obj.values())) + 1)))
            # plt.grid(axis="y", alpha=0.5)
            plt.text(
                0.95,
                0.95,
                f"avg {round(avg, 1)}\nstd {round(std, 1)}",
                horizontalalignment="right",
                verticalalignment="top",
                transform=plt.gca().transAxes,
                bbox=dict(facecolor="white", edgecolor="black", boxstyle="round,pad=1"),
            )
            plt.savefig(f"{result_name}.png")
            plt.clf()

            print(f"resultado: {result_name} \n avg: {avg} std: {std} \n")
